define([{name:"Love is blue",master:"理查德·克莱德曼",src:"http://m2.music.126.net/WbUb9IhcGl58EFfChcVd-Q==/5639395138953449.mp3"},{name:"鸟之诗",master:"V.A.",src:"http://120.198.244.56:9999/m2.music.126.net/Zaz9AHLJppSjeLM-78Akig==/6040716883451498.mp3"},{name:"V.A.~勿念他归-千本樱",master:"V.A.",src:"http://120.198.244.44:9999/m2.music.126.net/hvTY_PDCMhEbEMh4TfxqiA==/5931865231944544.mp3"}]),document.attachEvent&&alert("这个例子不支持 Old IE 哦"),define(function(a){var i=a("./data"),n=a("./player"),t=new n(i);t.render()}),define(function(a,i,n){function t(a){this.global=null,this.audio=null,this.loopType=2,this.json=a,this.curTrack=null,this.prvTrack=null,this.nxtTrack=null}function l(a){var i=~~(a/60),n=~~(a%60);return 10>i&&(i="0"+i),10>n&&(n="0"+n),i+":"+n}n.exports=t,t.prototype.render=function(){a("jquery");this._createEl(),this._bind()},t.prototype.init=function(a){$(".play-ing .pbar .cur .cur-inner").width(0),$(".play-ing .ptitle a.title").html(a.name),$(".play-ing .ptitle a.singer").html(a.master),this.audio.src=a.src,this.audio.play()},t.prototype._bind=function(){var a=this;$("body").on("click",function(){$(".play-ctrl .cbar").hide()}),$(this.global).on("click",".play-btns a.play",function(){""===a.audio.src?(a.prvTrack=a.curTrack=a.json[2],a.init(a.curTrack)):a.audio.paused?a.audio.play():a.audio.pause()}).on("click",".play-btns a.prv",function(){null!==a.prvTrack&&a.init(a.prvTrack)}).on("click",".play-btns a.nxt",function(){if(null!==a.nxtTrack)a.init(a.nxtTrack),a.nxtTrack=null;else{var i=~~(Math.random()*a.json.length);a.prvTrack=a.curTrack,a.curTrack=a.json[i],a.nxtTrack=null,a.init(a.curTrack)}}).on("click",".play-ing .pbar .barbg",function(i){var n=i.offsetX/$(this).width();a.audio.currentTime=n*a.audio.duration}).on("click",".play-ctrl a.icon-vol",function(i){i.stopPropagation(),$(".play-ctrl .cbar").toggle(),$(".play-ctrl .cbar .cur").height(100*a.audio.volume+"%")}).on("click",".play-ctrl .cbar",function(i){var n=1-(i.pageY-$(this).offset().top)/$(this).height();n>1?n=1:0>n&&(n=0),a.audio.volume=n,i.stopPropagation()}).on({click:function(){var i=a.loopType;3===i?($(this).attr("class","icon-one"),$(this).siblings(".lop-hint").html("单曲循环").show(),a.loopType=1,a.audio.loop=!0):2===i?($(this).attr("class","icon-shuffle"),$(this).siblings(".lop-hint").html("随机播放").show(),a.loopType=3,a.audio.loop=!1):($(this).attr("class","icon-loop"),$(this).siblings(".lop-hint").html("列表循环").show(),a.loopType=2,a.audio.loop=!1)},mouseleave:function(){$(this).siblings(".lop-hint").hide()}},".play-ctrl a#icn-lop"),$(this.audio).on("canplay",function(){$(".play-ing .pbar .cur span.btn-cur i").hide()}).on("play",function(){$(".play-btns .play").removeClass("play-ply").addClass("play-pas")}).on("timeupdate",function(){var i=~~(a.audio.currentTime/a.audio.duration*1e3)/10;$(".play-ing .pbar .cur .cur-inner").width(i+"%"),$(".play-ing .pbar .clock i").html(l(a.audio.currentTime))}).on("pause",function(){$(".play-btns .play").removeClass("play-pas").addClass("play-ply")}).on("durationchange",function(){$(".play-ing .clock em").html(l(a.audio.duration))}).on("loadstart",function(){$(".play-ing .pbar .cur span.btn-cur i").show()}).on("progress",function(){var i=0,n=a.audio.buffered.length;n>0&&(i=~~(a.audio.buffered.end(n-1)/a.audio.duration*1e3)/10,$(".play-ing .pbar .rdy").width(i+"%"))}).on("volumechange",function(){$(".play-ctrl .cbar .cur").height(~~(1e3*a.audio.volume)/10+"%")}).on("ended",function(){if(a.audio.loop===!1){var i=~~(Math.random()*a.json.length);a.prvTrack=a.curTrack,a.curTrack=a.json[i],a.nxtTrack=null,a.init(a.curTrack)}}).on("seeking",function(){console.log("seeking")})},t.prototype._createEl=function(){this.global=$("<div>").addClass("audio-player");var a=$("<div>").addClass("center-btn"),i=$("<div>").addClass("slide"),n=$("<div>").addClass("radius-list"),t=$("<div>").addClass("play-btns"),l=$("<div>").addClass("play-head"),s=$("<div>").addClass("play-ing"),o=$("<div>").addClass("play-ctrl"),c='<a href="javascript:;" class="icon-list" title="播放列表">0</a>';n.append(c),c='<a href="javascript:;" class="prv" title="上一首"></a><a href="javascript:;" class="play play-ply" title="播放"></a><a href="javascript:;" class="nxt" title="下一首"></a>',t.append(c),c='<a href="#"><img src="./images/player/default_album.jpg" alt=""></a>',l.append(c),c='<div class="ptitle"><a href="#" class="title" title="曲名"></a><a href="#" class="singer" title="演绎者"></a></div><div class="pbar"><div class="barbg"><div class="rdy"></div><div class="cur"><div class="cur-inner"><span class="btn-cur"><i></i></span></div></div></div><span class="clock"><i>00:00</i><span> / </span><em>00:00</em></span></div>',s.append(c),c='<div class="cbar"><div class="barbg"><div class="cur"><span class="btn-cur"></span></div></div></div><a href="javascript:;" class="icon-vol" title="音量"></a><a href="javascript:;" class="icon-loop" id="icn-lop" title="循环"></a><div class="lop-hint">单曲循环</div>',o.append(c),a.append(n),i.append(t).append(l).append(s).append(o),this.global.append(a).append(i),$("body").prepend(this.global),this.audio=$("<audio>").appendTo(this.global).hide(),this.audio=this.audio[0],this.audio.volume=.5}});